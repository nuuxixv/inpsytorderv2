# ♊️ GEMINI Project Guide

이 문서는 Gemini AI 에이전트가 이 프로젝트를 일관되고 효율적으로 지원하기 위한
핵심 가이드입니다. 에이전트는 작업을 수행하기 전에 반드시 이 문서를 참고해야
합니다.

## 1. 프로젝트 개요

- **프로젝트명**: 인싸이트 오더 v2 (inpsytorderv2)
- **핵심 기능**: 학회/이벤트 기반 주문 관리 시스템
- **기술 스택**:
  - **프론트엔드**: React, Vite, JavaScript
  - **백엔드/DB**: Supabase (PostgreSQL)
  - **스타일링**: CSS (App.css, index.css)

## 2. 개발 환경

- **운영체제**: **Windows (`win32`)**
  - **파일/폴더 명령어**:
    - 파일 삭제: `del [파일명]` (절대 `rm` 사용 금지)
    - 폴더 삭제: `rmdir /s /q [폴더명]` (절대 `rm -rf` 사용 금지)
- **패키지 매니저**: `npm`
- **프론트엔드 위치**: `inpsyt-order-frontend/`

## 3. 주요 명령어

- **의존성 설치**:
  ```bash
  cd inpsyt-order-frontend
  npm install
  ```
- **프론트엔드 개발 서버 실행**:
  ```bash
  cd inpsyt-order-frontend
  npm run dev
  ```
- **Supabase 로컬 환경 시작**:
  ```bash
  supabase start
  ```
- **테스트 실행**:
  - 현재 설정되지 않음 (향후 `Vitest` 또는 `React Testing Library` 도입 예정)
- **린트 실행**:
  ```bash
  cd inpsyt-order-frontend
  npm run lint
  ```

## 4. 데이터베이스 (Supabase)

- **DB 종류**: PostgreSQL
- **스키마 관리**: Supabase Migrations
  - **새 마이그레이션 생성**: `supabase migrations new [마이그레이션_이름]`
  - **로컬 DB에 마이그레이션 적용**: `supabase db reset` (Docker Desktop 실행
    필수)
- **주요 테이블**: `events`, `orders`, `order_items`, `products`

## 5. 코딩 컨벤션 및 아키텍처

- **프론트엔드**:
  - **컴포넌트 기반 아키텍처**: `src/components` (재사용 가능한 UI 컴포넌트)
  - **API 계층 분리**: `src/api` (Supabase 데이터 요청 로직을 컴포넌트에서
    분리하여 관리)
  - **상태 관리**:
    - React Context API (`AuthContext`: 인증 및 권한, `NotificationContext`:
      알림)
    - `useReducer`: 복잡한 페이지 상태 관리 (예: `OrderManagementPage`)
  - **라우팅**: `react-router-dom`
  - **보안 및 인증**:
    - `ProtectedRoute`: 로그인 여부 및 권한(`permissions`) 기반 라우트 보호
    - **RBAC (Role-Based Access Control)**: `view`, `edit`, `master` 등 세분화된
      권한 체계 적용
- **백엔드**:
  - **Supabase Edge Functions**: 비즈니스 로직 구현 (`supabase/functions`)
  - **Database RPC**: 데이터 무결성이 중요한 복합 트랜잭션 처리 (예:
    `update_order_details`, `bulk_update_order_status`)
  - **Triggers**: 데이터 변경 감지 및 후처리 (HTTP 요청 직접 호출 지양,
    `pg_notify` 활용 권장)

## 6. 프로젝트 비전 및 핵심 원칙

이 섹션은 프로젝트의 본질적인 목적, 운영 모델, 제약 사항을 정의하여 모든
참여자(AI 에이전트 '지니' 포함)가 일관된 방향성을 유지하도록 돕습니다.

- **프로젝트 목적 (Purpose):**
  - 특정 학회 및 단기 이벤트를 위한 임시 주문 접수 및 관리 시스템입니다.
  - 상시 운영되는 쇼핑몰이 아니며, 연간 약 20회 내외로 단발성으로 사용됩니다.

- **핵심 운영 모델 (Operating Model):**
  - 이벤트별 고유 URL을 통해 주문을 접수합니다.
  - 관리자는 관리자 페이지를 통해 접수된 주문을 확인하고, 필요한 경우 수동으로
    상태를 변경합니다.
  - 배송 및 CS 관련 업무는 이 시스템에서 처리하지 않고, 기존 채널(홈페이지, 유선
    등)을 통해 진행합니다.

- **주요 제약사항 (Constraints & Non-Goals):**
  - **재고 관리:** 회사 메인 ERP와 연동하지 않으며, 실시간 재고 관리를 하지
    않습니다. (단, 이벤트별 판매 수량 제한은 고려할 수 있습니다.)
  - **결제 시스템:** PG(결제 대행사)와 연동하지 않습니다. 모든 결제 확인 및 환불
    처리는 관리자가 외부 수단을 통해 수동으로 진행합니다.
  - **고객 기능:** 고객이 직접 주문을 추적하거나 정보를 수정하는 기능은 제공하지
    않습니다.

- **고도화 방향성 (Future Vision):**
  - **운영자 편의성 극대화:** 주문 관리, 상태 변경, 정보 확인 등 관리자가
    수동으로 처리해야 하는 업무를 최대한 빠르고 정확하게 수행할 수 있도록
    지원하는 기능을 중심으로 발전시킵니다.
  - **휴먼 에러 방지:** 수동 작업 시 발생할 수 있는 실수를 최소화하기 위한
    기록(예: 관리자 메모) 및 검증 장치를 마련합니다.

## 7. AI 에이전트 문제 해결 원칙

이 섹션은 AI 에이전트가 복잡하고 어려운 문제에 직면했을 때, 더 빠르고 정확하게
원인을 찾고 해결하기 위한 원칙과 행동 계획을 정의합니다.

### 원칙 1: "눈으로 직접 확인하기 전까지는 아무것도 믿지 않는다."

- **가정 금지:** "코드가 있으니 실행됐을 것이다", "로그가 없으니 문제없을
  것이다" 와 같은 가정을 버립니다.
- **선(先) 시스템 확인, 후(後) 코드 분석:** 데이터베이스나 외부 시스템과
  상호작용하는 문제를 다룰 때, 코드 분석에 앞서 **시스템의 실제 상태(테이블
  스키마, RLS 정책, 트리거, 외부 API 상태 등)를 가장 먼저 확인**하는 것을
  철칙으로 삼습니다.

### 원칙 2: "가장 단순한 경로에서 시작하여 복잡성을 더해간다."

- **최소 단위 테스트:** 다중 계층(클라이언트-서버-DB) 아키텍처에서 문제가
  발생하면, 전체 흐름을 디버깅하기 전에 **가장 핵심적인 단위(예: 클라이언트-DB
  직접 연결)부터 테스트**하여 정상 동작 여부를 확인합니다.
- **점진적 확장:** 최소 단위 테스트가 성공하면, RPC, Edge Function 등 계층을
  하나씩 추가하며 테스트하여 어느 지점에서 문제가 발생하는지 명확하게
  고립시킵니다.

### 원칙 3: "오류가 없다는 것은 가장 큰 오류 신호다."

- **Silent Failure 의심:** 명확한 오류 없이 기능이 동작하지 않는 상황(Silent
  Failure)에서는 즉시 "숨겨진 제약 조건" (RLS, DB 트리거, 권한 문제 등)이나
  "환경 문제"를 최우선으로 의심합니다.
- **강제 오류 발생:** `EXCEPTION` 블록 추가, 고의적인 잘못된 값 전달 등
  의도적으로 오류를 발생시켜 숨겨진 문제를 수면 위로 끌어올리는 전략을
  적극적으로 사용합니다.

### 구체적인 행동 계획 (Action Plan)

데이터베이스 관련 문제 발생 시, 아래의 체크리스트를 순서대로 진행합니다.

1. **[ ] 스키마 확인:** 대상 테이블의 컬럼, 데이터 타입이 코드와 일치하는가?
   (SQL `\d table_name` 또는 GUI)
2. **[ ] RLS 정책 확인:** `pg_policies` 뷰를 통해 의도치 않은 RLS가 있는가?
3. **[ ] 트리거 확인:** `information_schema.triggers`를 통해 의도치 않은
   트리거가 있는가?
4. **[ ] 권한 확인:** 해당 역할(`anon`, `authenticated`)이 테이블에 대한
   `SELECT`, `INSERT`, `UPDATE`, `DELETE` 권한을 가지고 있는가?
5. **[ ] 최소 단위 테스트:** 클라이언트에서 직접 DB를 조작하여 기본 동작을
   확인한다.
6. **[ ] 점진적 확장:** 문제가 없다면 RPC, Edge Function 순으로 기능을 추가하며
   테스트한다.
